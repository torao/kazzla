/* Copyright (C) 2012 BJÃ¶RFUAN
 * This source and related resources are distributed under Apache License, Version 2.0.
 */
package com.kazzla.drpc

import collection.mutable.HashMap

// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
// Future
// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
/**
 * @author Takami Torao
 */
class Future[T] private[drpc](id:Long) {

	// ========================================================================
	//
	// ========================================================================
	/**
	 *
	 */
	private[this] val signal = new Object()

	// ========================================================================
	//
	// ========================================================================
	/**
	 *
	 */
	private[this] var value:Option[T] = None

	// ========================================================================
	//
	// ========================================================================
	/**
	 *
	 */
	def apply():T = get(0)

	// ========================================================================
	//
	// ========================================================================
	/**
	 *
	 */
	def get(timeout:Long):T = {
		signal.synchronized{
			value match {
				case Some(value) => value
				case None =>
					if(timeout > 0){
						signal.wait(timeout)
					} else {
						signal.wait()
					}
					value.get
			}
		}
	}

	// ========================================================================
	//
	// ========================================================================
	/**
	 *
	 */
	private[drpc] def set(v:T):Unit = {
		signal.synchronized{
			value = Some(v)
			signal.notifyAll()
		}
	}

}
